{% extends "base.html" %}
{% block nav_dash %}active{% endblock %}

{% block extra_head %}
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/face_mesh.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-gauge@0.3.0/dist/chartjs-chart-gauge.min.js"></script>
{% endblock %}

{% block content %}

<!-- ‚îÄ‚îÄ BACKGROUND TRACKING BANNER ‚îÄ‚îÄ -->
<div id="bgBanner" style="display:none;background:linear-gradient(135deg,rgba(123,92,240,0.12),rgba(0,212,255,0.08));
    border:1px solid rgba(123,92,240,0.3);border-radius:10px;padding:10px 18px;margin-bottom:14px;
    align-items:center;gap:12px;font-size:0.8rem;color:var(--text-primary)">
    <span style="font-size:1.1rem">üëÅÔ∏è</span>
    <div>
        <span style="font-weight:600">Tracking continues in the background</span>
        <span style="color:var(--text-muted);margin-left:8px">‚Äî camera is active, data is being recorded while you work in other tabs</span>
    </div>
    <span id="bgFrameCount" style="margin-left:auto;font-family:'Space Mono',monospace;font-size:0.68rem;color:var(--accent2)"></span>
</div>

<!-- ‚îÄ‚îÄ BREAK ALERT ‚îÄ‚îÄ -->
<div class="break-alert" id="breakAlert">
    <span class="ba-icon bi bi-exclamation-triangle-fill"></span>
    <div>
        <div class="ba-title">‚ö†Ô∏è Break Recommended</div>
        <div class="ba-sub">You've been active for over 45 minutes. Rest your eyes for 5‚Äì10 minutes.</div>
    </div>
</div>

<!-- ‚îÄ‚îÄ STAT CARDS ‚îÄ‚îÄ -->
<div class="grid-row grid-4">

    <div class="neo-card">
        <div class="c-icon i-danger"><i class="bi bi-activity"></i></div>
        <div class="c-label">Burnout Risk</div>
        <div class="c-value
            {% if burnout_risk == 'Low' %}col-green
            {% elif burnout_risk == 'Medium' %}col-warn
            {% else %}col-danger{% endif %}" id="burnoutRiskVal">
            {{ burnout_risk }}
        </div>
        <div class="c-meta">Score: <span style="color:var(--text-primary);font-family:'Space Mono',monospace">{{ burnout_score }}</span>
            &nbsp;<span class="rbadge {% if burnout_risk == 'Low' %}rbadge-low{% elif burnout_risk == 'Medium' %}rbadge-medium{% else %}rbadge-high{% endif %}">{{ burnout_risk }}</span>
        </div>
    </div>

    <div class="neo-card">
        <div class="c-icon i-cyan"><i class="bi bi-eye"></i></div>
        <div class="c-label">Blink Count</div>
        <div class="c-value col-cyan" id="blinkCount">0</div>
        <div class="c-meta">Session blinks detected</div>
    </div>

    <div class="neo-card">
        <div class="c-icon i-purple"><i class="bi bi-person-standing"></i></div>
        <div class="c-label">Posture Status</div>
        <div class="c-value col-green" id="postureStatus">Waiting...</div>
        <div class="c-meta" id="tiltValue">Tilt: ‚Äî</div>
    </div>

    <div class="neo-card">
        <div class="c-icon i-green"><i class="bi bi-clock-history"></i></div>
        <div class="c-label">Session Duration</div>
        <div class="c-value col-green" id="sessionTimer">00:00</div>
        <div class="c-meta">Active monitoring time</div>
    </div>

</div>

<!-- ‚îÄ‚îÄ LIVE + GAUGE ‚îÄ‚îÄ -->
<div class="sec-label">Live Monitor</div>
<div class="grid-row grid-2" style="margin-bottom:20px">

    <div class="neo-card" style="padding:0;overflow:hidden">
        <!-- Camera loading state -->
        <div id="camStatus" style="
            position:absolute; inset:0; display:flex; flex-direction:column;
            align-items:center; justify-content:center; gap:10px;
            background:rgba(6,11,18,0.9); z-index:10; border-radius:12px;
            font-family:'Space Mono',monospace; font-size:0.72rem; color:var(--text-muted);
        ">
            <div id="camSpinner" style="width:36px;height:36px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 1s linear infinite"></div>
            <span id="camStatusText">Requesting camera access...</span>
        </div>
        <div class="vid-wrap" style="position:relative">
            <video id="videoEl" autoplay playsinline muted style="transform:scaleX(-1);border-radius:9px;width:100%;display:block;background:#000;min-height:220px"></video>
            <div class="vid-tag">
                <span id="liveDot" style="width:5px;height:5px;background:var(--text-muted);border-radius:50%;display:inline-block"></span>
                &nbsp;<span id="liveLabel">INITIALISING</span>
            </div>
            <!-- Canvas overlay for face mesh (hidden) -->
            <canvas id="faceCanvas" style="display:none"></canvas>
        </div>
        <div style="padding:12px 16px">
            <div class="c-label">Camera Feed ‚Äî MediaPipe Face Mesh</div>
            <div id="alertMsg" style="font-size:0.78rem;color:var(--danger);min-height:18px"></div>
        </div>
    </div>

    <div class="neo-card" style="display:flex;flex-direction:column;align-items:center;justify-content:center">
        <div class="c-label" style="margin-bottom:8px">Fatigue Severity Index</div>
        <canvas id="fatigueGauge" style="max-height:200px;max-width:280px"></canvas>
        <div style="margin-top:10px;text-align:center">
            <div style="font-family:'Space Mono',monospace;font-size:1.5rem;font-weight:700" id="gaugeVal">0.00</div>
            <div class="c-meta">Current fatigue probability</div>
        </div>
    </div>

</div>

<!-- ‚îÄ‚îÄ ANALYTICS ‚îÄ‚îÄ -->
<div class="sec-label">7-Day Analytics</div>
<div class="grid-row grid-2">
    <div class="neo-card">
        <div class="c-label" style="margin-bottom:12px">Fatigue Trend</div>
        <canvas id="fatigueChart" style="max-height:200px"></canvas>
    </div>
    <div class="neo-card">
        <div class="c-label" style="margin-bottom:12px">Work Hours</div>
        <canvas id="workChart" style="max-height:200px"></canvas>
    </div>
</div>

<!-- ‚îÄ‚îÄ TIPS ‚îÄ‚îÄ -->
<div class="sec-label" style="margin-top:20px">Wellness Tips</div>
<div class="grid-row grid-3">
    <div class="neo-card" style="border-left:3px solid var(--accent)">
        <div style="font-size:1.2rem;margin-bottom:8px">üëÅÔ∏è</div>
        <div style="font-size:0.82rem;font-weight:600;margin-bottom:4px">20-20-20 Rule</div>
        <div style="font-size:0.75rem;color:var(--text-muted)">Every 20 min, look at something 20 feet away for 20 seconds to reduce eye strain.</div>
    </div>
    <div class="neo-card" style="border-left:3px solid var(--accent3)">
        <div style="font-size:1.2rem;margin-bottom:8px">üßò</div>
        <div style="font-size:0.82rem;font-weight:600;margin-bottom:4px">Micro Breaks</div>
        <div style="font-size:0.75rem;color:var(--text-muted)">Take a 5-minute break after every 45‚Äì50 minutes of focused work to prevent burnout.</div>
    </div>
    <div class="neo-card" style="border-left:3px solid var(--accent2)">
        <div style="font-size:1.2rem;margin-bottom:8px">üíß</div>
        <div style="font-size:0.82rem;font-weight:600;margin-bottom:4px">Stay Hydrated</div>
        <div style="font-size:0.75rem;color:var(--text-muted)">Dehydration increases fatigue. Drink at least 8 glasses of water during your workday.</div>
    </div>
</div>

<style>
@keyframes spin { to { transform: rotate(360deg); } }
</style>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   NeuroWatch ‚Äî Background-Aware Tracking Engine
   Works when you switch to other tabs / windows
   Strategy:
     1. getUserMedia keeps the camera stream alive regardless of tab focus
     2. setInterval-based frame pump (instead of rAF) ‚Äî browsers throttle
        requestAnimationFrame in background tabs but NOT setInterval (up to 1s)
     3. Page Visibility API ‚Äî detect hide/show, adjust frame rate, update UI
     4. Wake Lock API ‚Äî prevent device sleep during active session
     5. Web Worker ‚Äî keep the send-throttle clock ticking independently
        of the main thread being backgrounded
   ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

/* ‚îÄ‚îÄ‚îÄ CONSTANTS ‚îÄ‚îÄ‚îÄ */
const LEFT_EYE  = [33,160,158,133,153,144];
const RIGHT_EYE = [362,385,387,263,373,380];
const BREAK_MINS = {{ settings.break_interval_minutes|default:45 }};
const CSRF = (()=>{
    let v=null;
    document.cookie.split(';').forEach(c=>{c=c.trim();if(c.startsWith('csrftoken='))v=decodeURIComponent(c.slice(10));});
    return v;
})();

/* ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ */
let blinkCount = 0;
let eyeClosedFrames = 0;
let eyeClosedSince = null;     // timestamp when eye closed
let blinkInProgress = false;   // true while eye is currently closed
const BLINK_MIN_MS = 50;       // real blink: eye closed ‚â• 50ms
const BLINK_MAX_MS = 400;      // real blink: eye closed ‚â§ 400ms (longer = sleepy, not blink)
let fatigueGaugeChart = null;
let sessionStart = Date.now();
let meshReady = false;
let isBackground = false;
let frameInterval = null;       // setInterval handle for frame pump
let lastSentAt = 0;             // throttle: send every 10s
let lastBlinkForSend = 0, lastTiltForSend = 0, lastClosureForSend = 0;
let wakeLock = null;
let faceMesh;

/* ‚îÄ‚îÄ‚îÄ WEB WORKER (inline) ‚Äî keeps send-throttle alive in background ‚îÄ‚îÄ‚îÄ */
/* The worker just fires a message every 10s so the main thread can
   check if it's time to POST data, even when the tab is throttled. */
const workerCode = `
    let interval = setInterval(() => postMessage('tick'), 10000);
`;
const workerBlob = new Blob([workerCode], { type: 'application/javascript' });
const sendWorker = new Worker(URL.createObjectURL(workerBlob));
sendWorker.onmessage = () => {
    // Worker tick ‚Äî send latest readings to backend (background-safe)
    doSend(lastBlinkForSend, lastClosureForSend, lastTiltForSend);
};

/* ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ */
function dist(a, b) { return Math.sqrt((a.x-b.x)**2+(a.y-b.y)**2); }
function calcEAR(lm, eye) {
    return (dist(lm[eye[1]],lm[eye[5]])+dist(lm[eye[2]],lm[eye[4]])) /
           (2.0*dist(lm[eye[0]],lm[eye[3]]));
}

/* ‚îÄ‚îÄ‚îÄ WAKE LOCK ‚Äî prevent sleep during session ‚îÄ‚îÄ‚îÄ */
async function requestWakeLock() {
    if ('wakeLock' in navigator) {
        try {
            wakeLock = await navigator.wakeLock.request('screen');
        } catch(e) { /* not critical */ }
    }
}
// Re-acquire wake lock when tab becomes visible again (it releases on hide)
document.addEventListener('visibilitychange', async () => {
    if (document.visibilityState === 'visible' && wakeLock === null) {
        await requestWakeLock();
    }
});

/* ‚îÄ‚îÄ‚îÄ CAMERA STATUS UI ‚îÄ‚îÄ‚îÄ */
function setCamStatus(text, isError=false) {
    document.getElementById('camStatusText').textContent = text;
    if (isError) {
        document.getElementById('camSpinner').style.borderTopColor = 'var(--danger)';
        document.getElementById('camStatusText').style.color = 'var(--danger)';
    }
}
function hideCamOverlay() {
    const el = document.getElementById('camStatus');
    el.style.opacity = '0'; el.style.transition = 'opacity 0.5s';
    setTimeout(()=>{ el.style.display='none'; }, 500);
    setLiveIndicator(true);
}
function setLiveIndicator(live) {
    document.getElementById('liveDot').style.background  = live ? 'var(--accent3)' : 'var(--warning)';
    document.getElementById('liveDot').style.animation   = live ? 'blink 1.5s infinite' : 'none';
    document.getElementById('liveLabel').textContent     = live ? 'LIVE' : 'BACKGROUND';
}

/* ‚îÄ‚îÄ‚îÄ SESSION TIMER (setInterval is NOT throttled in background tabs) ‚îÄ‚îÄ‚îÄ */
setInterval(() => {
    const elapsed = Math.floor((Date.now() - sessionStart) / 1000);
    const m = Math.floor(elapsed / 60), sec = elapsed % 60;
    document.getElementById('sessionTimer').textContent =
        String(m).padStart(2,'0') + ':' + String(sec).padStart(2,'0');

    // Break reminder
    if (m >= BREAK_MINS && m % BREAK_MINS === 0 && sec === 0) {
        fetch('/alerts/break/', {method:'POST', headers:{'X-CSRFToken':CSRF}}).catch(()=>{});
    }
    if (m >= BREAK_MINS) document.getElementById('breakAlert').classList.add('show');
    else document.getElementById('breakAlert').classList.remove('show');
}, 1000);

/* ‚îÄ‚îÄ‚îÄ PAGE VISIBILITY API ‚îÄ‚îÄ‚îÄ */
let bgFrames = 0;
document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'hidden') {
        isBackground = true;
        setLiveIndicator(false);
        // Slow frame rate in background (1 frame every 2s) ‚Äî saves CPU, still tracks
        restartFramePump(2000);
        // Show background banner when user returns
    } else {
        isBackground = false;
        setLiveIndicator(meshReady);
        restartFramePump(100);
        // Show how many background frames were captured
        if (bgFrames > 0) {
            const banner = document.getElementById('bgBanner');
            document.getElementById('bgFrameCount').textContent = `${bgFrames} frames captured while away`;
            banner.style.display = 'flex';
            bgFrames = 0;
            setTimeout(() => { banner.style.display = 'none'; }, 6000);
        }
    }
});

/* ‚îÄ‚îÄ‚îÄ FRAME PUMP (setInterval ‚Äî works in background unlike rAF) ‚îÄ‚îÄ‚îÄ */
let frameProcessing = false;  // lock ‚Äî prevent overlapping async faceMesh.send()

function restartFramePump(intervalMs) {
    if (frameInterval) clearInterval(frameInterval);
    frameInterval = setInterval(captureFrame, intervalMs);
}

const videoEl = document.getElementById('videoEl');

async function captureFrame() {
    // Skip if previous frame hasn't finished processing ‚Äî prevents queue buildup
    if (frameProcessing || !faceMesh || videoEl.readyState < 2 || videoEl.paused) return;
    frameProcessing = true;
    try {
        await faceMesh.send({ image: videoEl });
        if (isBackground) bgFrames++;
    } catch(e) { /* model initialising */ }
    finally { frameProcessing = false; }
}

/* ‚îÄ‚îÄ‚îÄ FACE MESH ‚îÄ‚îÄ‚îÄ */
function initFaceMesh() {
    faceMesh = new FaceMesh({
        locateFile: f => `https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${f}`
    });
    faceMesh.setOptions({
        maxNumFaces: 1, refineLandmarks: false,
        minDetectionConfidence: 0.5, minTrackingConfidence: 0.5
    });
    faceMesh.onResults(onResults);
}

function onResults(results) {
    if (!meshReady) { meshReady = true; hideCamOverlay(); }

    if (!results.multiFaceLandmarks?.length) {
        if (!isBackground) {
            document.getElementById('postureStatus').textContent = 'No Face';
            document.getElementById('postureStatus').className = 'c-value col-warn';
            document.getElementById('alertMsg').textContent = 'üë§ No face detected ‚Äî move closer';
        }
        return;
    }

    const lm = results.multiFaceLandmarks[0];

    /* ‚îÄ‚îÄ Blink detection ‚Äî time-based, works at any frame rate ‚îÄ‚îÄ */
    const avgEAR = (calcEAR(lm, LEFT_EYE) + calcEAR(lm, RIGHT_EYE)) / 2;
    const now = Date.now();
    const eyeClosed = avgEAR < 0.22;   // slightly higher threshold = more sensitive

    if (eyeClosed && !blinkInProgress) {
        // Eye just closed ‚Äî start timing
        blinkInProgress = true;
        eyeClosedSince = now;
    } else if (!eyeClosed && blinkInProgress) {
        // Eye just opened ‚Äî measure how long it was closed
        const closedDuration = now - eyeClosedSince;
        blinkInProgress = false;
        eyeClosedSince = null;

        if (closedDuration >= BLINK_MIN_MS && closedDuration <= BLINK_MAX_MS) {
            // Valid blink duration ‚Äî count it
            blinkCount++;
            if (!isBackground) document.getElementById('blinkCount').textContent = blinkCount;
        }
        // If closedDuration > BLINK_MAX_MS it's prolonged closure (drowsiness), not a blink
    }

    // For backend: closure duration in seconds
    const closureDuration = blinkInProgress ? (now - eyeClosedSince) / 1000 : 0;

    /* Head tilt */
    const lo=lm[33], ro=lm[263];
    const tilt = Math.abs(Math.atan2(ro.y-lo.y, ro.x-lo.x)*(180/Math.PI));

    /* Cache latest readings for the worker-driven send */
    lastBlinkForSend   = blinkCount;
    lastClosureForSend = closureDuration;
    lastTiltForSend    = tilt;

    /* Update UI only when tab is visible (no point updating hidden DOM) */
    if (!isBackground) {
        document.getElementById('tiltValue').textContent = `Tilt: ${tilt.toFixed(1)}¬∞`;
        const postureEl = document.getElementById('postureStatus');
        if (tilt > {{ settings.posture_tilt_threshold|default:15 }}) {
            postureEl.textContent = 'Poor Posture';
            postureEl.className = 'c-value col-danger';
            document.getElementById('alertMsg').textContent = '‚ö†Ô∏è Poor posture ‚Äî sit upright!';
        } else {
            postureEl.textContent = 'Good';
            postureEl.className = 'c-value col-green';
            document.getElementById('alertMsg').textContent = '';
        }
    }
}

/* ‚îÄ‚îÄ‚îÄ SEND TO BACKEND (called by Web Worker tick) ‚îÄ‚îÄ‚îÄ */
function doSend(blink, closure, tilt) {
    // Also guard with time check in case worker fires too fast
    const now = Date.now();
    if (now - lastSentAt < 9000) return;
    lastSentAt = now;
    fetch('/save-fatigue/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': CSRF },
        body: JSON.stringify({ blink_rate: blink, eye_closure_duration: closure, head_tilt_angle: tilt })
    }).catch(()=>{});
}

/* ‚îÄ‚îÄ‚îÄ START EVERYTHING ‚îÄ‚îÄ‚îÄ */
async function startCamera() {
    setCamStatus('Requesting camera access...');
    let stream;
    try {
        stream = await navigator.mediaDevices.getUserMedia({
            video: { width:{ideal:640}, height:{ideal:480}, facingMode:'user' },
            audio: false
        });
    } catch(err) {
        setCamStatus('Camera access denied. Please allow camera permissions.', true);
        return;
    }

    videoEl.srcObject = stream;
    videoEl.onloadedmetadata = async () => {
        await videoEl.play();
        setCamStatus('Loading AI model...');
        initFaceMesh();
        await requestWakeLock();
        restartFramePump(100);  // start at full rate (10fps)
    };
    videoEl.onerror = () => setCamStatus('Video error. Try refreshing.', true);
}

if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', startCamera);
else startCamera();

/* ‚îÄ‚îÄ‚îÄ GAUGE ‚îÄ‚îÄ‚îÄ */
function initGauge(val) {
    const ctx = document.getElementById('fatigueGauge');
    if (!fatigueGaugeChart) {
        fatigueGaugeChart = new Chart(ctx, {
            type: 'gauge',
            data: {
                datasets: [{
                    value: val,
                    minValue: 0,
                    data: [0.4, 0.7, 1.0],
                    backgroundColor: ['#00e5a0', '#ffd166', '#ff4d6d']
                }]
            },
            options: {
                needle: { radiusPercentage: 2, widthPercentage: 3.2, lengthPercentage: 80, color: 'rgba(255,255,255,0.85)' },
                valueLabel: { display: false }
            }
        });
    } else {
        fatigueGaugeChart.data.datasets[0].value = val;
        fatigueGaugeChart.update();
    }
    document.getElementById('gaugeVal').textContent = val.toFixed(2);
}

initGauge(0);
function loadGauge() {
    fetch('/current-fatigue/')
        .then(r => r.json())
        .then(d => initGauge(d.fatigue))
        .catch(() => {});
}
loadGauge();
setInterval(loadGauge, 8000);

/* ‚îÄ‚îÄ‚îÄ CHARTS ‚îÄ‚îÄ‚îÄ */
Chart.defaults.color = '#4d7a9e';
Chart.defaults.borderColor = '#1a2e47';
Chart.defaults.font.family = "'DM Sans', sans-serif";

fetch('/analytics-data/')
    .then(r => r.json())
    .then(data => {
        new Chart(document.getElementById('fatigueChart'), {
            type: 'line',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Avg Fatigue',
                    data: data.fatigue,
                    borderColor: '#00d4ff',
                    backgroundColor: 'rgba(0,212,255,0.08)',
                    fill: true, tension: 0.4, pointRadius: 4,
                    pointBackgroundColor: '#00d4ff',
                    pointBorderColor: '#060b12', pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#4d7a9e', font: { size: 11 } } } },
                scales: {
                    x: { grid: { color: '#1a2e47' }, ticks: { color: '#4d7a9e' } },
                    y: { grid: { color: '#1a2e47' }, ticks: { color: '#4d7a9e' }, min: 0, max: 1 }
                }
            }
        });

        new Chart(document.getElementById('workChart'), {
            type: 'bar',
            data: {
                labels: data.labels,
                datasets: [{
                    label: 'Work Hours',
                    data: data.work_hours,
                    backgroundColor: 'rgba(123,92,240,0.5)',
                    borderColor: '#7b5cf0',
                    borderWidth: 1, borderRadius: 5
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { labels: { color: '#4d7a9e', font: { size: 11 } } } },
                scales: {
                    x: { grid: { color: '#1a2e47' }, ticks: { color: '#4d7a9e' } },
                    y: { grid: { color: '#1a2e47' }, ticks: { color: '#4d7a9e' }, min: 0 }
                }
            }
        });
    });
</script>
{% endblock %}
